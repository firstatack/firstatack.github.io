<p><img src="assets/master/portada.png" alt="portada" /></p>

<p>En este reto de <a href="https://dockerlabs.es" title="DockerLabs">DockerLabs</a> practicamos.</p>

<ul>
  <li>Scan de puertos</li>
  <li>Busqueda de vulnerabilidad en wordpress</li>
  <li>wp-automatic 3.92 ultima vulnerable</li>
  <li>Inyeccion de comandos a script de bash</li>
</ul>

<h2 id="herramientas-y-recursos">Herramientas y recursos</h2>

<ul>
  <li>nmap</li>
  <li>sudo</li>
</ul>

<h2 id="reconocimiento-y-enumeracion">Reconocimiento y enumeracion</h2>

<p>Lo primero como siempre le tiramos un nmap con los parámetros de costumbre.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--min-rate</span><span class="o">=</span>5000 <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oX</span> master 172.17.0.2
</code></pre></div></div>

<p><a href="/reporte/master.html">reporte</a></p>

<p>En este caso nos encontramos solo con el protocolo <strong>http</strong> abierto por el 80 y lo que aparentemenmte es un wordpress no aparenta ser vulnerable y herramientas como wpscan no reportan nada.
No obstante hay un bug en un pluggin que esta usando.</p>

<p><img src="assets/master/web.png" alt="web" /></p>

<p>Analizamos visualmente y tambien su codigo , visualmete ya nos encontramos que tiene el plugin wp-automatic que se encarga de auto postear , traducir y reescribir contenido desde otros lugare , o  eso creo.</p>

<p><img src="assets/master/pluggin.png" alt="pluggin" /></p>

<p>En este caso no era listable el contenido y aparte de la pista de arriba tambien podemos encontrarlo de otras fomas leyendo en bruto,  con curl y con grep ……</p>

<p><img src="assets/master/auto.png" alt="auto" /></p>

<p><a href="https://thehackernews.com/2024/04/hackers-exploiting-wp-automatic-plugin.html" title="info">info</a></p>

<p>Yo encontre dos formas de explotarlo una desde burpsuite y la otra un script python como con burp no me llevo bien del todo tiro del script.</p>

<p><a href="https://github.com/diego-tella/CVE-2024-27956-RCE" title="script">script</a></p>

<p><img src="assets/master/script.png" alt="script" /></p>

<p>Al ejecutarlo nos creo un usuario privilegiado en wordpress. asi que vamos a ello.</p>

<h2 id="infiltracion">Infiltracion</h2>

<p>Una vez dentro voy a hacerla corta , me desplaza a add new pluggin e instalo un file manager y lo activamos.</p>

<p>Como veis en la imagen de abajo me desplazo al dir uploads y creo un fichero con el contenido de la rev de monkey.</p>

<p><img src="assets/master/fm.png" alt="fm" /></p>

<p>Una vez creado solo nos ponemos a la escuha primero y luego ejecutamos desde el navegador.</p>

<p><img src="assets/master/uploads.png" alt="uploads" /></p>

<p>Una vez dentro seremos <strong>www-data</strong> y necesitamos empezar a movernos lateralmente entre usuarios.</p>

<h2 id="movimientos-laterales">Movimientos laterales</h2>

<p>Con sudo -l tenemos suerte</p>

<p><img src="assets/master/sudol1.png" alt="sudol1" /></p>

<p>Si abusamos de php nos convertimos en pylon.</p>

<p><img src="assets/master/pylon.png" alt="pylon" /></p>

<p>Volvemos a ejecutar sudo -l  y a ver que nos dejaron.</p>

<p><img src="assets/master/sudol2.png" alt="sudol2" /></p>

<p>Nos dejo un script para oder pasar a mario , ejecutemsolo y veamos que hace.</p>

<p><img src="assets/master/ejecu.png" alt="ejecu" /></p>

<p>Pareciera que es parecido al que la maquina <strong>whoiam</strong> y hace uso de <strong>eq</strong>. ASi que trataremos de inyectarle el array con nuestro comando.</p>

<p><img src="assets/master/eq.png" alt="eq" /></p>

<p>Ahora como mario a por root encontramos lo mismo pero apuntando al directorio de pylon.</p>

<p><img src="assets/master/root.png" alt="root" /></p>

<blockquote class="prompt-info">
  <p>Metodo manual con  <a href="https://github.com/truonghuuphuc/CVE-2024-27956" title="burpsuite">burpsuite</a></p>
</blockquote>

<p>Muchas gracias por llegar hasta aqui</p>

