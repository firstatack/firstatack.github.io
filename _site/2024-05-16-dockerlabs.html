<p><img src="assets/logo-dockerlabs.png" alt="logodocker" w="200" h="200" /></p>

<p>En este reto de <a href="https://dockerlabs.es" title="dockerlabs">DockerLabs</a>  encontramos con escaneo de puertos para buscar una entrada al sistema, enumeracion de directorios y ficheros , file bypass , revshell y escalada final.</p>

<h2 id="herramientas-y-recursos-usados">Herramientas y recursos usados</h2>

<ul>
  <li>Nmap</li>
  <li>feroxbuster</li>
  <li>bypass en control de archivos</li>
</ul>

<h2 id="enumeracion">Enumeracion</h2>

<p>Empezamos lanzando un nmap contra el objetivo .</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--min-rate</span><span class="o">=</span>5000 <span class="nt">-n</span> <span class="nt">-Pn</span> <span class="nt">-oX</span> dockerlabs 172.17.0.2  
</code></pre></div></div>
<p><a href="/reporte/dockerlabs.html" title="reportesnmap">Reporte nmap</a></p>

<p>En este caso solo nos da el 80 de apache, asi que revisamos la web.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>feroxbuster <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-t</span> 400 <span class="nt">-e</span> <span class="nt">-x</span> php,txt,html,jpg,js <span class="nt">-u</span> http://172.17.0.2/
</code></pre></div></div>
<p><img src="assets/dockerlabs/ferox.png" alt="ferox" /></p>

<p>La web no nos aporto nada .</p>

<p>Lanzamos Feroxbuster tenemos suerte y nos encuentra una carpeta uploads y un archivo php.</p>

<p><img src="assets/dockerlabs/subida.png" alt="subida" /></p>

<p><img src="assets/dockerlabs/solozip.png" alt="onlyzip" /></p>

<h2 id="bypass">Bypass</h2>

<p>La subida de archivos esta restringida solo permite zip , tenemos que bypasear eso.
Yo probe a√±adiendo y modificando la extension sin suerte.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>webshell.zip.php
webshell-php.zip
webshell.php%0d%0a
</code></pre></div></div>

<p>No funciono , recorde que en una maquina utilce un tipo de extensio que es de compresion en php acabado en <strong>PHAR</strong></p>

<p><a href="http://cursophp.disca.upv.es/archive/recursos/php-es/phar.compressfiles.html" title="info PHAR">phar</a></p>

<p>Me lanzo burpsuite y miro el accept encoding , no estoy seguro de que sirva pero podriamos trastear mas con el burp haciendo un ataque para ver que extensiones perimte (mi nivel de burp es 0,1) no se como hacer eso asi que pruebo manualmente a subir el <strong>.phar</strong></p>

<p><img src="assets/dockerlabs/burp.png" alt="burp" /></p>

<h2 id="infiltracion">Infiltracion</h2>

<p>Tenemos exito subiendolo con esa extension , asi que directos a la websshel que acabamos de subir para enviarnos directo una revshell amnuestra maquina.</p>

<p><img src="assets/dockerlabs/webshell.png" alt="webshell" /></p>

<p>Como vemos en la imagen nos mandamos una revshell poniendos antes a la escucha.</p>

<p>Una vez logueado hacemos lo oportuno.</p>

<p><img src="assets/dockerlabs/sudo.png" alt="sudo" /></p>

<p>Vemos cosas prometedoras con sudo parece que algo nos deja hacer y tambien encotramos la <strong>nota.txt</strong>.</p>

<p>Revisemos la nota.</p>

<p><img src="assets/dockerlabs/nota.png" alt="nota" /></p>

<h2 id="escalada">Escalada</h2>

<p>El fichero nos dice donde esta la clave de root y sudo nos daba dos opciones para leer ficheros como son grep y cut , hacemos uso de searchbins para ver como se explota</p>

<p><img src="assets/dockerlabs/search.png" alt="searchbins" /></p>

<p>Creamos la variable de entorno hacia el archiovo que queremos leer y luego ejecutamos el comando sudo.</p>

<p><img src="assets/dockerlabs/sudo.png" alt="sudo" /></p>

<p>Listo hasta aqui la maquina.</p>

<p>Difundan y compartan.</p>

<p>Muchas gracias por leer</p>

