<p>Este es un reto clasificado como de dificultad muy facil de la plataforma <a href="https://dockerlabs.es" title="dockerlabs">Dockerlabs</a>.</p>

<p>Nos encontramos con las siguientes características y dificultades , en el tendremos que localizar la entrada al sistema , subir webshell , reverse shell y escalada de privelegios.</p>

<h2 id="herramientas-y-recursos-usados">HERRAMIENTAS Y RECURSOS USADOS</h2>

<ul>
  <li>nmap</li>
  <li>webshell</li>
  <li>searchbins</li>
</ul>

<h2 id="enumeracion">Enumeracion</h2>

<p>Como al arrancar la maquina ya nos dice la ip , nos olvidamos de arp-scan , comprobamos la conexion con un ping.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
ping <span class="nt">-c1</span> 172.17.0.2

</code></pre></div></div>

<p>Ahora realizamos un nmap como de costumbre sin preocuparnos del ruido pues estamos en entorno de pruebas.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">-sS</span> <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">--min-rate</span><span class="o">=</span>5000 <span class="nt">-n</span> <span class="nt">-vvv</span> <span class="nt">-Pn</span> 172.17.0.2 <span class="nt">-oX</span> puertos
</code></pre></div></div>

<p><a href="/reporte/upload_nmap.html" title="Reporte nmap">Reporte</a></p>

<p>Observamos el resultado y vemos que solo tiene el 80.</p>

<p>Empecemos por revisar la web y nos encontramos directamente con una web de subida de archivos y tratamos de subir una webshell.</p>

<p><img src="assets/upload/webupload.png" alt="web" /></p>

<p><img src="assets/upload/webuploadphp.png" alt="upload_shell" /></p>

<p>Como vemos hemos podido subir el fichero .php raro que no estuviese filtrado de algun modo , ahora hemos de averiguar como podemos ejecutarlo para ello tendremos que saber el nombre del directorio donde se subio. Yo hoy voy a probar dirsearch pues no todos los programoas tienen los mismos tipos de escaneos u opciones , de paso aprendemos a manejar otros programas.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>dirsearch <span class="nt">-u</span> http://172.17.0.2 <span class="nt">-e</span> php,html,txt <span class="nt">-w</span> /usr/share/dirbuster/directory-list-2.3-medium.txt
</code></pre></div></div>

<p><img src="assets/upload/dirsearch.png" alt="dirsearch" /></p>

<h2 id="infiltración">Infiltración</h2>

<p>Ahora que ya tenemos todo listo es decir , hemos subido el php malicioso y sabemos donde se ha almacedado pasamos a conectarnos a la web para poder mandarnos una revshell.
Pononemos netcat como de costumbre antes de nada</p>

<p><img src="assets/upload/revshell.png" alt="revshell" /></p>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<p>Una vez dentro listamos directorios importantes y tambien lo primero es ejecutar como de costumbre find y sudo que nos buscaran ficheros con permisos erroneos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>find / <span class="nt">-perm</span> <span class="nt">-4000</span> 2&gt;/dev/null
<span class="nb">sudo</span> <span class="nt">-l</span>
</code></pre></div></div>

<p><img src="assets/upload/sudo.png" alt="salida_sudo" /></p>

<p>Sudo nos arroja el binario env disponible para escalar hasta root.</p>

<p>Lo buscamos en searchbins para saber como ejecutarlo y nos hacemos root
<img src="assets/upload/searchbins.png" alt="searchbins" /></p>

<p><img src="assets/upload/root.png" alt="root" /></p>

<p>Gracias por leer</p>

